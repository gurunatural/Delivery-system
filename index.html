<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GURU Customer Directory Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        .glass-header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .customer-card {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .customer-card:active {
            transform: scale(0.97);
            background-color: #f9fafb;
        }

        #modalContent {
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .loader {
            border-top-color: #ef4444;
            animation: spinner 0.8s linear infinite;
        }

        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .search-container {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }

        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-900">

    <!-- Header -->
    <header class="glass-header sticky top-0 z-30 px-4 py-4">
        <div class="max-w-4xl mx-auto">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-red-600 rounded-lg flex items-center justify-center shadow-lg shadow-red-200">
                        <i class="fa-solid fa-users text-white text-sm"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-black tracking-tight text-slate-800 leading-none">GURU</h1>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-0.5">Directory</p>
                    </div>
                </div>
                
                <div class="flex items-center gap-3">
                    <div class="text-right">
                        <p class="text-[10px] font-black text-red-600 uppercase tracking-tighter">Live Database</p>
                        <p class="text-xs font-bold text-slate-500"><span id="customerCount">0</span> Records</p>
                    </div>
                    <button onclick="fetchData()" class="w-10 h-10 rounded-full bg-white border border-slate-200 flex items-center justify-center text-slate-600 active:rotate-180 transition-transform duration-500">
                        <i class="fa-solid fa-rotate"></i>
                    </button>
                </div>
            </div>
            
            <div class="relative max-w-2xl mx-auto search-container rounded-2xl bg-white flex items-center px-4 border border-slate-100">
                <i class="fa-solid fa-magnifying-glass text-slate-400"></i>
                <input 
                    type="text" 
                    id="searchInput"
                    autofocus
                    enterkeyhint="search"
                    autocomplete="off"
                    placeholder="Search name, ID, or location..." 
                    class="w-full px-3 py-3.5 bg-transparent border-none focus:ring-0 outline-none font-semibold text-slate-700 text-base"
                >
                <button id="clearSearch" class="hidden p-2 text-slate-300 hover:text-slate-500">
                    <i class="fa-solid fa-circle-xmark"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto p-4 pb-24">
        <!-- Initial Loader -->
        <div id="loading" class="flex flex-col items-center justify-center py-32">
            <div class="loader ease-linear rounded-full border-4 border-slate-200 h-12 w-12 mb-4"></div>
            <p class="text-slate-400 text-xs font-black animate-pulse tracking-widest uppercase">Syncing Cloud Data</p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="hidden text-center py-20 px-6 bg-white rounded-3xl border border-red-100 shadow-sm">
            <div class="w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fa-solid fa-triangle-exclamation text-red-500 text-2xl"></i>
            </div>
            <h3 class="text-lg font-black text-slate-800 uppercase">Connection Interrupted</h3>
            <p class="text-slate-500 mt-2 text-sm leading-relaxed" id="errorMessage">Unable to reach the customer database. Please check your internet connection.</p>
            <button onclick="fetchData()" class="mt-8 px-10 py-4 bg-red-600 text-white font-black rounded-2xl shadow-xl shadow-red-200 active:scale-95 transition-all uppercase text-xs tracking-widest">
                Try Reconnecting
            </button>
        </div>

        <!-- List Container -->
        <div id="customerList" class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3"></div>

        <!-- No Results -->
        <div id="noResults" class="hidden text-center py-32">
            <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fa-solid fa-magnifying-glass text-slate-300 text-3xl"></i>
            </div>
            <p class="text-slate-400 font-bold">No matches found</p>
            <p class="text-slate-300 text-xs mt-1 font-medium">Try checking for typos or use different keywords.</p>
        </div>
    </main>

    <!-- Success Toast -->
    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 z-[100] bg-slate-900 text-white px-6 py-3 rounded-full text-xs font-bold shadow-2xl transition-all duration-300 translate-y-20 opacity-0 pointer-events-none uppercase tracking-widest">
        Copied to clipboard
    </div>

    <!-- Detail Modal -->
    <div id="detailModal" class="fixed inset-0 z-50 hidden flex items-end sm:items-center justify-center p-0 sm:p-4 bg-slate-900/60 backdrop-blur-md transition-opacity duration-300 opacity-0">
        <div class="bg-white w-full max-w-md rounded-t-[2.5rem] sm:rounded-[2.5rem] overflow-hidden shadow-2xl transform translate-y-full flex flex-col relative" id="modalContent">
            
            <!-- Modal Close -->
            <button onclick="closeModal()" class="absolute top-4 right-4 bg-white/20 hover:bg-white/40 backdrop-blur-md text-white w-10 h-10 rounded-full flex items-center justify-center z-20 transition-colors">
                <i class="fa-solid fa-xmark text-lg"></i>
            </button>

            <!-- Modal Visual -->
            <div class="relative h-56 bg-slate-800">
                <img id="modalPhoto" src="" alt="Customer" class="w-full h-full object-cover opacity-90" onerror="this.src='https://images.unsplash.com/photo-1564013799919-ab600027ffc6?q=80&w=800'">
                <div class="absolute inset-0 bg-gradient-to-t from-white via-transparent to-black/30"></div>
                <div class="absolute bottom-0 left-0 right-0 p-6">
                    <span id="modalId" class="inline-block text-[10px] font-black bg-red-600 text-white px-3 py-1 rounded-full uppercase tracking-widest mb-2 shadow-lg shadow-red-200"></span>
                    <h2 id="modalName" class="text-2xl font-black text-slate-900 leading-tight"></h2>
                </div>
            </div>

            <!-- Modal Body -->
            <div class="px-6 py-6 space-y-5 overflow-y-auto no-scrollbar max-h-[60vh]">
                <!-- Contact Section -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="p-3 bg-emerald-50 rounded-2xl border border-emerald-100">
                        <p class="text-[9px] text-emerald-600 font-black uppercase tracking-tighter mb-1">Primary Phone</p>
                        <p id="modalPhone" class="text-sm font-black text-slate-800 truncate"></p>
                    </div>
                    <div class="p-3 bg-orange-50 rounded-2xl border border-orange-100">
                        <p class="text-[9px] text-orange-600 font-black uppercase tracking-tighter mb-1">Secondary</p>
                        <p id="modalAltPhone" class="text-sm font-black text-slate-800 truncate"></p>
                    </div>
                </div>

                <!-- Location Section -->
                <div class="flex items-start gap-4 p-4 bg-blue-50 rounded-2xl border border-blue-100">
                    <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center flex-shrink-0 shadow-lg shadow-blue-200">
                        <i class="fa-solid fa-location-dot text-white"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-[9px] text-blue-600 font-black uppercase tracking-tighter mb-0.5">Physical Address</p>
                        <p id="modalAddress" class="text-sm font-bold text-slate-700 leading-snug"></p>
                    </div>
                </div>

                <!-- Action Grid -->
                <div class="grid grid-cols-4 gap-3 pt-2">
                    <a id="bigCallBtn" href="#" class="flex flex-col items-center gap-2">
                        <div class="w-14 h-14 bg-emerald-600 text-white rounded-2xl flex items-center justify-center shadow-lg shadow-emerald-200 active:scale-90 transition-transform">
                            <i class="fa-solid fa-phone text-xl"></i>
                        </div>
                        <span class="text-[10px] font-black text-slate-500 uppercase">Call</span>
                    </a>
                    <a id="whatsappBtn" href="#" target="_blank" class="flex flex-col items-center gap-2">
                        <div class="w-14 h-14 bg-green-500 text-white rounded-2xl flex items-center justify-center shadow-lg shadow-green-200 active:scale-90 transition-transform">
                            <i class="fa-brands fa-whatsapp text-2xl"></i>
                        </div>
                        <span class="text-[10px] font-black text-slate-500 uppercase">Chat</span>
                    </a>
                    <a id="directionBtn" href="#" target="_blank" class="flex flex-col items-center gap-2">
                        <div class="w-14 h-14 bg-blue-600 text-white rounded-2xl flex items-center justify-center shadow-lg shadow-blue-200 active:scale-90 transition-transform">
                            <i class="fa-solid fa-route text-xl"></i>
                        </div>
                        <span class="text-[10px] font-black text-slate-500 uppercase">Map</span>
                    </a>
                    <button onclick="copyToClipboard()" class="flex flex-col items-center gap-2">
                        <div class="w-14 h-14 bg-slate-800 text-white rounded-2xl flex items-center justify-center shadow-lg shadow-slate-200 active:scale-90 transition-transform">
                            <i class="fa-solid fa-copy text-xl"></i>
                        </div>
                        <span class="text-[10px] font-black text-slate-500 uppercase">Copy</span>
                    </button>
                </div>
            </div>
            
            <div class="h-8 bg-white shrink-0"></div>
        </div>
    </div>

    <script>
        const CSV_URL = `https://docs.google.com/spreadsheets/d/e/2PACX-1vSretHvAs4tMhyEZvG7BAFuOYnSk28vfK__jGIb_sbYetP2vGk0-sO8mw29DIRYlAGI6BVdvLDH5H-c/pub?output=csv`;

        let customers = [];
        let filteredCustomers = [];
        let currentRenderId = 0;
        let selectedCustomer = null;

        window.onload = fetchData;

        async function fetchData() {
            try {
                const loadingEl = document.getElementById('loading');
                const errorEl = document.getElementById('errorState');
                loadingEl.classList.remove('hidden');
                errorEl.classList.add('hidden');
                
                const response = await fetch(`${CSV_URL}&t=${Date.now()}`); // Cache busting
                if (!response.ok) throw new Error("Sync Failed");
                const text = await response.text();
                
                parseFullCSV(text);
                
                loadingEl.classList.add('hidden');
                filteredCustomers = [...customers];
                renderList(filteredCustomers);
            } catch (err) {
                document.getElementById('loading').classList.add('hidden');
                const errorState = document.getElementById('errorState');
                errorState.classList.remove('hidden');
                document.getElementById('errorMessage').textContent = "Failed to load database. Please try again later.";
            }
        }

        function parseFullCSV(text) {
            const rows = text.split(/\r?\n/);
            if (rows.length < 2) return;

            const headerRow = splitCSVRow(rows[0]);
            const columnsMap = {
                id: headerRow.findIndex(h => h.toLowerCase().includes('id')),
                name: headerRow.findIndex(h => h.toLowerCase().includes('name')),
                address: headerRow.findIndex(h => h.toLowerCase().includes('address')),
                mobile: headerRow.findIndex(h => h.toLowerCase().includes('mobile') || h.toLowerCase().includes('primary')),
                alt: headerRow.findIndex(h => h.toLowerCase().includes('alternate') || h.toLowerCase().includes('alt')),
                link: headerRow.findIndex(h => h.toLowerCase().includes('link') || h.toLowerCase().includes('location')),
                photo: headerRow.findIndex(h => h.toLowerCase().includes('photo') || h.toLowerCase().includes('home'))
            };

            customers = rows.slice(1).map(row => {
                if (!row.trim()) return null;
                const cols = splitCSVRow(row);
                return {
                    id: cols[columnsMap.id] || 'N/A',
                    name: cols[columnsMap.name] || 'Unknown Customer',
                    address: cols[columnsMap.address] || 'No address provided',
                    mobile: cols[columnsMap.mobile] || '',
                    altMobile: cols[columnsMap.alt] || '',
                    location: cols[columnsMap.link] || '',
                    photo: cols[columnsMap.photo] || ''
                };
            }).filter(c => c !== null);

            document.getElementById('customerCount').textContent = customers.length;
        }

        function splitCSVRow(row) {
            const result = [];
            let current = '';
            let inQuote = false;
            for (let i = 0; i < row.length; i++) {
                const char = row[i];
                if (char === '"') {
                    if (inQuote && row[i+1] === '"') { current += '"'; i++; }
                    else { inQuote = !inQuote; }
                } else if (char === ',' && !inQuote) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        function renderList(list) {
            const container = document.getElementById('customerList');
            const renderId = ++currentRenderId;
            container.innerHTML = '';
            
            if (list.length === 0) {
                document.getElementById('noResults').classList.remove('hidden');
                return;
            }
            document.getElementById('noResults').classList.add('hidden');
            
            const CHUNK_SIZE = 40; 
            let index = 0;

            function renderChunk() {
                if (renderId !== currentRenderId) return;

                const end = Math.min(index + CHUNK_SIZE, list.length);
                const chunkHtml = [];

                for (let i = index; i < end; i++) {
                    const c = list[i];
                    const avatar = c.photo || `https://ui-avatars.com/api/?name=${encodeURIComponent(c.name)}&background=f1f5f9&color=64748b&bold=true`;
                    
                    chunkHtml.push(`
                        <div class="customer-card bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex items-center gap-4 cursor-pointer" onclick="openModalByIndex(${i})">
                            <div class="w-14 h-14 rounded-2xl overflow-hidden bg-slate-50 flex-shrink-0 border border-slate-100">
                                <img src="${avatar}" class="w-full h-full object-cover" loading="lazy">
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2 mb-0.5">
                                    <span class="text-[8px] font-black text-red-600 bg-red-50 px-1.5 py-0.5 rounded uppercase tracking-tighter">${c.id}</span>
                                </div>
                                <h3 class="text-sm font-black text-slate-800 truncate leading-tight">${c.name}</h3>
                                <p class="text-[10px] text-slate-400 truncate font-semibold mt-0.5">${c.address}</p>
                            </div>
                            <i class="fa-solid fa-angle-right text-slate-300 text-xs"></i>
                        </div>
                    `);
                }

                container.insertAdjacentHTML('beforeend', chunkHtml.join(''));
                index = end;
                if (index < list.length) {
                    requestAnimationFrame(renderChunk);
                }
            }
            renderChunk();
        }

        // Search logic
        let searchTimeout;
        const searchInput = document.getElementById('searchInput');
        const clearBtn = document.getElementById('clearSearch');

        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase().trim();
            clearBtn.classList.toggle('hidden', query === '');

            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                if (!query) {
                    filteredCustomers = [...customers];
                } else {
                    const terms = query.split(/\s+/);
                    filteredCustomers = customers.filter(c => {
                        const searchString = `${c.name} ${c.id} ${c.address} ${c.mobile}`.toLowerCase();
                        return terms.every(t => searchString.includes(t));
                    });
                }
                renderList(filteredCustomers);
                document.getElementById('customerCount').textContent = filteredCustomers.length;
            }, 150);
        });

        clearBtn.addEventListener('click', () => {
            searchInput.value = '';
            searchInput.dispatchEvent(new Event('input'));
            searchInput.focus();
        });

        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') searchInput.blur();
        });

        function openModalByIndex(index) {
            const c = filteredCustomers[index];
            if (!c) return;
            selectedCustomer = c;

            document.getElementById('modalName').textContent = c.name;
            document.getElementById('modalId').textContent = `Customer ID: ${c.id}`;
            document.getElementById('modalAddress').textContent = c.address;
            document.getElementById('modalPhone').textContent = c.mobile || 'Not available';
            document.getElementById('modalAltPhone').textContent = c.altMobile || 'Not available';
            
            const photo = document.getElementById('modalPhoto');
            photo.src = c.photo || 'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?q=80&w=800';

            // Phone Link
            const callBtn = document.getElementById('bigCallBtn');
            if (c.mobile) {
                callBtn.href = `tel:${c.mobile.replace(/\D/g, '')}`;
                callBtn.classList.remove('opacity-30', 'pointer-events-none');
            } else {
                callBtn.classList.add('opacity-30', 'pointer-events-none');
            }

            // WhatsApp Link
            const waBtn = document.getElementById('whatsappBtn');
            if (c.mobile) {
                const cleanPhone = c.mobile.replace(/\D/g, '');
                // Assuming Indian context (prefix 91) if not present
                const waPhone = cleanPhone.length === 10 ? `91${cleanPhone}` : cleanPhone;
                waBtn.href = `https://wa.me/${waPhone}?text=Hello ${encodeURIComponent(c.name)},`;
                waBtn.classList.remove('opacity-30', 'pointer-events-none');
            } else {
                waBtn.classList.add('opacity-30', 'pointer-events-none');
            }

            // Directions Link
            const dir = document.getElementById('directionBtn');
            if (c.location && c.location.includes('http')) {
                dir.href = c.location;
                dir.classList.remove('opacity-30', 'pointer-events-none');
            } else {
                dir.classList.add('opacity-30', 'pointer-events-none');
            }

            const modal = document.getElementById('detailModal');
            const content = document.getElementById('modalContent');
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.add('opacity-100');
                content.classList.remove('translate-y-full');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('detailModal');
            const content = document.getElementById('modalContent');
            
            modal.classList.remove('opacity-100');
            content.classList.add('translate-y-full');
            
            setTimeout(() => {
                modal.classList.add('hidden');
                selectedCustomer = null;
            }, 300);
        }

        function copyToClipboard() {
            if (!selectedCustomer) return;
            const text = `Customer: ${selectedCustomer.name}\nID: ${selectedCustomer.id}\nPhone: ${selectedCustomer.mobile}\nAddress: ${selectedCustomer.address}`;
            
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);

            showToast("Details Copied");
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 2000);
        }

        document.getElementById('detailModal').addEventListener('click', (e) => {
            if (e.target.id === 'detailModal') closeModal();
        });
    </script>
</body>
</html>
